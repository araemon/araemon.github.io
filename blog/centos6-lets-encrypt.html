<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>
ğŸ’»CentOS 6.x ã«ç„¡æ–™SSL Let's Encrypt ã‚’å°å…¥ã™ã‚‹</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<link rel="stylesheet" type="text/css" href="/css/icon.css"  />
<link rel="stylesheet" type="text/css" href="/css/main.css?1544547617"  />
<link href="https://fonts.googleapis.com/css?family=Corben:700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c:900" rel="stylesheet">
<link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet" >
<style>


</style>
</head>
<body>

        <div id="container">
        <div id="header" class="blog">
        <div class="layerTransparent">
                <div class="container">
                <ul class="nav">
<li><a href="/blog/">Blog</a></li>
<li><a href="/kamityping/">KamiTyping</a></li>
<li><a href="/chazuke/">Chazuke</a></li>
<li><a href="/harmonize/">Harmonize</a></li>
<li><a href="/apps/">Other Apps</a></li>
<li><a href="mailto:i.officearai@gmail.com">Contact</a></li>
</ul>
<div class="copyright">Copyright Â© Toshihiko Arai</div>
                </div>
</div>
        </div>

<div id="contents">
<article>
<a href="/blog/">Blog (è¨˜äº‹ä¸€è¦§)</a>
<h1>
ğŸ’»CentOS 6.x ã«ç„¡æ–™SSL Let's Encrypt ã‚’å°å…¥ã™ã‚‹</h1>
<div class="time"><time pubdate="" datetime="2018-08-06">
2018-08-06</time></div>

        <ul class="shareList">
        <li class="shareList__item"><a class="shareList__link icon-twitter" href="https://twitter.com/intent/tweet?url=http://192.168.100.101/blog/centos6-lets-encrypt.html&text=%F0%9F%92%BBCentOS+6.x+%E3%81%AB%E7%84%A1%E6%96%99SSL+Let%27s+Encrypt+%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B" target="_blank" title="Twitter"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="Facebook"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-google-plus" href="https://plus.google.com/share?url=http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="Google+"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-hatebu" href="http://b.hatena.ne.jp/entry/http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-pocket" href="http://getpocket.com/edit?url=http://192.168.100.101/blog/centos6-lets-encrypt.html&title=%F0%9F%92%BBCentOS+6.x+%E3%81%AB%E7%84%A1%E6%96%99SSL+Let%27s+Encrypt+%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B" target="_blank" title="Pocket"></a></li>
        </ul>
<p>
<ul id="toc"><li><a href="#1">æ¡ä»¶</a></li><li><a href="#2">æ‰‹é †</a></li><li><a href="#3">curlã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ</a></li><li><a href="#4">certbotã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</a></li><li><a href="#5">Apacheã‚’åœæ­¢</a></li><li><a href="#6">certbotã‚’ä½¿ã£ã¦éµã‚’ä½œæˆ</a></li><li><a href="#7">Apacheã«éµã®ãƒ‘ã‚¹ã‚’è¨˜è¿°</a></li><li><a href="#8">Apache å†èµ·å‹•</a></li><li><a href="#9">ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚‚Let's Encryptã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹</a></li><li><a href="#10">è‡ªå‹•æ›´æ–°ã®è¨­å®š</a></li><li><a href="#11">faviconã§ã‚¨ãƒ©ãƒ¼</a></li><li><a href="#12">.htaccessã§httpsã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</a></li></li></ul>
<img src="https://cdn-ak.f.st-hatena.com/images/fotolife/a/araemonz/20180729/20180729102849.jpg" class="default" /><br><br><h2 id="1">æ¡ä»¶</h2>* Apacheã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã¯2.2.15ä»¥ä¸Šã¨ã™ã‚‹<br>* ã‚ªãƒ¬ã‚ªãƒ¬è¨¼æ˜æ›¸ã‚’æ—¢ã«ä½¿ã£ã¦ã„ã‚‹<br>* 443ãƒãƒ¼ãƒˆã¯è§£æ”¾æ¸ˆã¿<br>* ãƒãƒ¼ãƒãƒ£ãƒ«ãƒ›ã‚¹ãƒˆã§é‹å–¶ã—ã¦ã„ã‚‹<br>* CentOS 6.x<br><br>ã“ã®æ¡ä»¶ã§ä»¥ä¸‹ä½œæ¥­ã‚’è¡Œãªã£ã¦ã„ãã€‚<br>rootã«ãªã£ã¦/rootãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§æ“ä½œã—ãŸã€‚<br><br><br><h2 id="2">æ‰‹é †</h2>1. certbotã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰<br>2. Apacheã‚’åœæ­¢<br>3. certbotã‚’ä½¿ã£ã¦éµã‚’ä½œæˆ<br>4. Apacheã«éµã®ãƒ‘ã‚¹ã‚’è¨˜è¿°<br>5. Apacheã‚’å†èµ·å‹•<br>6. è‡ªå‹•æ›´æ–°ã®è¨­å®š<br><br><br><h2 id="3">curlã®ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆ</h2>**curlãŒå¤ã„ã¨ã†ã¾ãã„ã‹ãªã„ã®ã§äº‹å‰ã«ã‚¢ãƒƒãƒ—ãƒ‡ãƒ¼ãƒˆã—ã¦ãŠãã€‚**<br><pre><br>yum update curl<br></pre><br><br><h2 id="4">certbotã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«</h2><pre><br>git clone https://github.com/letsencrypt/letsencrypt<br></pre><br><br><h2 id="5">Apacheã‚’åœæ­¢</h2>Apacheã‚’æ­¢ã‚ãªã„ã¨è¨¼æ˜æ›¸ã‚’ä½œã‚Œãªã„ã®ã§æ­¢ã‚ã¦ãŠãã€‚<br><pre><br> /etc/rc.d/init.d/stop<br></pre><br><br><h2 id="6">certbotã‚’ä½¿ã£ã¦éµã‚’ä½œæˆ</h2>ã„ãã¤ã‹è³ªå•ã•ã‚Œã‚‹ãŒé›£ã—ã„ã“ã¨ã¯ãªã„ã€‚<br><pre><br> cd letsencrypt<br><br>./letsencrypt-auto certonly -a standalone -d hogedomain.com<br></pre><br><br>/etc/letsencrypt/live/hogedomain.com/ å†…ã«éµãŒä½œã‚‰ã‚ŒãŸ<br><br><pre><br>   ls /etc/letsencrypt/live/hogedomain.com/<br>   README  cert.pem  chain.pem  fullchain.pem  privkey.pem<br></pre><br><br><h2 id="7">Apacheã«éµã®ãƒ‘ã‚¹ã‚’è¨˜è¿°</h2>Apacheã«ã“ã®éµã®ãƒ‘ã‚¹ã‚’è¨­å®šã™ã‚‹ã€‚<br><br><pre><br>vi /etc/httpd/conf.d/ssl.conf<br><br>##ä»¥ä¸‹ã‚’æ›¸ãæ›ãˆã‚‹<br>SSLCertificateFile /etc/letsencrypt/live/hogedomain.com/fullchain.pem<br>SSLCertificateKeyFile /etc/letsencrypt/live/hogedomain.com/privkey.pem<br></pre><br><br><h2 id="8">Apache å†èµ·å‹•</h2>åœæ­¢ã—ã¦ã„ãŸApacheã‚’èµ·å‹•ã™ã‚‹ã€‚<br><br><pre><br>/etc/rc.d/init.d/httpd start<br></pre><br>ã“ã‚Œã§ãƒ«ãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã«SSLä»˜ãã§ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ã€‚<br><br><h2 id="9">ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³ã§ã‚‚Let's Encryptã‚’ä½¿ãˆã‚‹ã‚ˆã†ã«ã™ã‚‹</h2>ã‚µãƒ–ãƒ‰ãƒ¡ã‚¤ãƒ³æ¯ã«è¨­å®šã—ã¦ã‚„ã‚‰ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚<br>ã‚„ã‚Šæ–¹ã¯ãƒ«ãƒ¼ãƒˆãƒ‰ãƒ¡ã‚¤ãƒ³ã®æ™‚ã¨åŒã˜ã€‚<br><br><pre><br>./letsencrypt-auto certonly -a standalone -d sub.hogedomain.com<br></pre><br><pre><br>vi /etc/httpd/conf.d/virtualhost.conf<br><br>##ä»¥ä¸‹ã‚’è¿½åŠ <br>&lt;VirtualHost *:443&gt;<br>    ServerName sub.hogedomain.com<br>    DocumentRoot /somewhere/hogedomain/sub<br><br>    SSLEngine on<br>    SSLCertificateFile /etc/letsencrypt/live/sub.hogedomain.com/fullchain.pem<br>    SSLCertificateKeyFile /etc/letsencrypt/live/sub.hogedomain.com/privkey.pem<br><br>    ErrorLog logs/sslvirtual_error_log<br>    CustomLog logs/sslvirtual_access_log combined env=!no_log<br>   NameVirtualhost *:443<br>&lt;/VirtualHost&gt;<br></pre><br><br><h2 id="10">è‡ªå‹•æ›´æ–°ã®è¨­å®š</h2>Let's Encryptã¯ï¼“ãƒ¶æœˆã—ã‹æœ‰åŠ¹æœŸé™ãŒãªã„ã®ã§ã€è‡ªå‹•æ›´æ–°ã™ã‚‹ã¨ã‚ˆã„ã€‚æ›´æ–°ã®ãŸã‚ã®ã‚³ãƒãƒ³ãƒ‰ã‚’cronã™ã‚‹ã€‚<br>ã¾ãšã€ä¸‹è¨˜ã®ã‚³ãƒãƒ³ãƒ‰ãŒæ­£å¸¸ã«å‹•ä½œã—ã€è¨¼æ˜æ›¸ãŒæ›´æ–°ã•ã‚Œã‚‹ã‹ã‚’ãƒ†ã‚¹ãƒˆã€‚<br>renewã¯ã€ã™ã¹ã¦ã®è¨¼æ˜æ›¸ã‚’æ›´æ–°ã™ã‚‹ã‚³ãƒãƒ³ãƒ‰ã€‚--post-hookã‚ªãƒ—ã‚·ãƒ§ãƒ³ã§æŒ‡å®šã—ãŸã‚³ãƒãƒ³ãƒ‰ã¯ã€renewå¾Œã«å®Ÿè¡Œã•ã‚Œã‚‹ã€‚ãŸã ã—ã€renewã¯æœŸé™ãŒè¿«ã‚‰ãªã„ã†ã¡ã¯ã€å®Ÿè¡ŒãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã€ãã®å ´åˆã¯post-hookã‚‚å®Ÿè¡Œã•ã‚Œãªã„ã€‚<br><a href="https://qiita.com/takahiko/items/a08895550727b95b6c36">https://qiita.com/takahiko/items/a08895550727b95b6c36</a><br><br>è¨˜äº‹ã®ã‚ˆã†ã«è‡ªå‹•æ›´æ–°ã®è¨­å®šã‚’ã—ã¦ã„ãŸã®ã ãŒã€ãªãœã‹ãã®å¾Œã«æ›´æ–°ã‚’ã—ã¦ãã ã•ã„ã¨ã„ã†å†…å®¹ã®ãƒ¡ãƒ¼ãƒ«ãŒæ¥ã¦ã—ã¾ã£ãŸã€‚<br><br><pre><br>Hello,<br><br>Your certificate (or certificates) for the names listed below will expire in 20 days (on 18 Aug 18 07:08 +0000). Please make sure to renew your certificate before then, or visitors to your website will encounter errors.<br><br>We recommend renewing certificates automatically when they have a third of their<br>total lifetime left. For Let's Encrypt's current 90-day certificates, that means<br>renewing 30 days before expiration. See<br><a href="https://letsencrypt.org/docs/integration-guide/ for details.">https://letsencrypt.org/docs/integration-guide/ for details.</a><br><br>hogehoge.com<br><br>For any questions or support, please visit https://community.letsencrypt.org/. Unfortunately, we can't provide support by email.<br><br>If you are receiving this email in error, unsubscribe at http://mandrillapp.com/track/unsub.php?u=30850198&id=e6af6ce87eeb49cab9f7c4584c8d49da.Xdoz7jXx662gLBduhGy%2FwZtnakk%3D&r=https%3A%2F%2Fmandrillapp.com%2Funsub%3Fmd_email%3Daraemonz%2540gmail.com<br><br>Regards,<br>The Let's Encrypt Team<br></pre><br>ã©ã†ã‚‚ã€Apacheã‚’åœæ­¢ã—ã¦ã‹ã‚‰æ›´æ–°å‡¦ç†ã‚’ã—ã¦ã„ãªã‹ã£ãŸã®ãŒåŸå› ã®ã‚ˆã†ã ã€‚<br><br><pre><br>Saving debug log to /var/log/letsencrypt/letsencrypt.log<br><br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>Processing /etc/letsencrypt/renewal/hogehoge.com.conf<br>- - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -<br>Cert is due for renewal, auto-renewing...<br>Plugins selected: Authenticator standalone, Installer None<br>Renewing an existing certificate<br>Performing the following challenges:<br>tls-sni-01 challenge for hogehoge.com<br>Cleaning up challenges<br>Attempting to renew cert (hogehoge.com) from /etc/letsencrypt/renewal/hogehoge.com.conf produced an unexpected error: Problem binding to port 443: Could not bind to IPv4 or IPv6.. Skipping.<br></pre><br>ã¨ã„ã†ã“ã¨ã§ä»¥ä¸‹ã®ã‚ˆã†ã«cronã«ç™»éŒ²ã—ã¦ã¿ãŸã€‚<br>æ¯æœˆã®7æ—¥ã€04æ™‚00åˆ†ã«å®Ÿè¡Œã™ã‚‹ã€‚<br><br><pre><br>vi /etc/cron.d/letsencrypt<br><br>00 04 01 * * root /etc/rc.d/init.d/httpd stop && /usr/bin/certbot-auto renew && /etc/rc.d/init.d/httpd start<br></pre><br><pre><br>åˆ† æ™‚ æ—¥ æœˆ æ›œæ—¥ <å®Ÿè¡Œã‚³ãƒãƒ³ãƒ‰><br></pre><br><br><h2 id="11">faviconã§ã‚¨ãƒ©ãƒ¼</h2>ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ãŒå°ã•ã„è­¦å‘Šè¡¨ç¤ºã‚’å‡ºã—ã¦ã„ãŸã€‚<br>åŸå› ã¯faviconã ã£ãŸã€‚<br>ãƒ–ãƒ©ã‚¦ã‚¶ãƒ¼ãŒfaviconã‚’å‹æ‰‹ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆã™ã‚‹ã‚ˆã†ã§ã€faviconã‚’è¨­ç½®ã—ã¦ã„ãªã‹ã£ãŸãŸã‚ã«httpã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã‚¨ãƒ©ãƒ¼ãŒå‡ºãŸã¨ã„ã†ã“ã¨ã€‚<br>faviconã‚’è¨­ç½®ã—ã¦ç„¡äº‹ã‚¨ãƒ©ãƒ¼ã¯ãªããªã£ãŸã€‚<br><br><br><h2 id="12">.htaccessã§httpsã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆ</h2>httpã§ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã‚‚è‡ªå‹•ã§httpsã¸ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆã™ã‚‹ã‚ˆã†ã«.htaccessã‚’ç·¨é›†ã€‚<br><br><pre><br>RewriteEngine On<br>RewriteCond %{HTTPS} off<br>RewriteRule ^(.*)$ https://%{HTTP_HOST}%{REQUEST_URI} [R=301,L]<br></pre></p>
        <ul class="shareList">
        <li class="shareList__item"><a class="shareList__link icon-twitter" href="https://twitter.com/intent/tweet?url=http://192.168.100.101/blog/centos6-lets-encrypt.html&text=%F0%9F%92%BBCentOS+6.x+%E3%81%AB%E7%84%A1%E6%96%99SSL+Let%27s+Encrypt+%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B" target="_blank" title="Twitter"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-facebook" href="https://www.facebook.com/sharer/sharer.php?u=http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="Facebook"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-google-plus" href="https://plus.google.com/share?url=http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="Google+"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-hatebu" href="http://b.hatena.ne.jp/entry/http://192.168.100.101/blog/centos6-lets-encrypt.html" target="_blank" title="ã¯ã¦ãªãƒ–ãƒƒã‚¯ãƒãƒ¼ã‚¯"></a></li>
        <li class="shareList__item"><a class="shareList__link icon-pocket" href="http://getpocket.com/edit?url=http://192.168.100.101/blog/centos6-lets-encrypt.html&title=%F0%9F%92%BBCentOS+6.x+%E3%81%AB%E7%84%A1%E6%96%99SSL+Let%27s+Encrypt+%E3%82%92%E5%B0%8E%E5%85%A5%E3%81%99%E3%82%8B" target="_blank" title="Pocket"></a></li>
        </ul>

</article>
</div>
            </div>

<div id="page_top"><a href="#"></a></div>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
/****************************************
 * TOPã¸æˆ»ã‚‹ãƒœã‚¿ãƒ³è¡¨ç¤º
 ***************************************/
$(function() {
    var pagetop = $('#page_top');
    pagetop.hide();
    $(window).scroll(function () {
        if ($(this).scrollTop() > 100) {  //100pxã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã—ãŸã‚‰è¡¨ç¤º
            pagetop.fadeIn();
        } else {
            pagetop.fadeOut();
        }
    });
    pagetop.click(function () {
        $('body,html').animate({
            scrollTop: 0
        }, 300); //0.3ç§’ã‹ã‘ã¦ãƒˆãƒƒãƒ—ã¸ç§»å‹•
        return false;
    });
});

</script>
</body>
</html>