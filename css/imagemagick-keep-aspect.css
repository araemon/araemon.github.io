---
title:"ImageMagickでアスペクト比を維持しながら画像をリサイズする"
date:"2018-05-11"
category:"blog"
---
rubyで作ったResizer.rbをシェルスクリプトに書き直して改善してみた。
pngファイルで背景が透過だとjpgで黒塗りにされてしまうが、-flatten のオプションをつける事で白塗りになる。


## 設計
image:https://cdn-ak.f.st-hatena.com/images/fotolife/a/araemonz/20180729/20180729122748.jpg

1. Resizer.commandと同じディレクトリに変換したいpngまたはjpgファイルを置く（複数可）。
2. Resizer.commandをダブルクリックし、標準入力でリサイズしたい大きさを入力する。
3. 縦横がそのサイズに収まるようにアスペクト比を維持しながらjpgに置き換えられる。
4. 元画像はoriginalフォルダに格納される。


## 実装
resizer.command
```
#!/bin/bash
cd `dirname $0`

#-flattenで透過画像を白塗り背景に

read -p "Enter resize limit size: " limitSize

mkdir -p ./original
mkdir -p ./tmp

converter () {
    target_file=$1
    cp $target_file ./original/${target_file}
    name=${target_file%.*}
    echo ${target_file}
    convert $target_file -resize ${limitSize}x${limitSize} -flatten ./tmp/$name.jpg
    rm -f $target_file
}

for file in `\find . -maxdepth 1 -name '*.png' -o -name '*.PNG' -o -name '*.jpg' -o -name '*.JPG'`; do
    converter $file
done

cp ./tmp/* .
rm -Rf ./tmp
```

<a target="_blank"  href="https://www.amazon.co.jp/gp/product/4797377623/ref=as_li_tl?ie=UTF8&camp=247&creative=1211&creativeASIN=4797377623&linkCode=as2&tag=101010fun-22&linkId=b73336026353f211400d68f588761dbb"><img border="0" src="//ws-fe.amazon-adsystem.com/widgets/q?_encoding=UTF8&MarketPlace=JP&ASIN=4797377623&ServiceVersion=20070822&ID=AsinImage&WS=1&Format=_SL250_&tag=101010fun-22" ></a><img src="//ir-jp.amazon-adsystem.com/e/ir?t=101010fun-22&l=am2&o=9&a=4797377623" width="1" height="1" border="0" alt="" style="border:none !important; margin:0px !important;" />